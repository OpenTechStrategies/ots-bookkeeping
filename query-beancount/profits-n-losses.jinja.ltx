\BLOCK{extends "letterhead.jinja.ltx"}
\BLOCK{block body}

% We used to use 'longtabu' here.  However, at some point in late 2021
% or early 2022 'pdflatex' started producing an error on the generated
% file, and investigating that led to this answer on StackOverflow:
% https://tex.stackexchange.com/questions/600724/dimension-too-large-after-recent-longtable-update
%
% TL;DR: Package 'tabu' is unmaintained; we shouldn't use it anymore.
%
% It turns out that 'tabu' was sensitive to internals of 'longtable',
% so recent upgrades to that ended up breaking 'tabu'.  If we wanted
% something kind of like 'tabu', https://ctan.org/pkg/tabularray is
% the modern replacement for it.  However, we don't need either for
% this template, so we just use straight 'longtable' now.  We eat our
% vegetables.  We like them.
\begin{longtable}{ l  l  l  r}
  & & & \VAR{year} \\
  \cline{4-4}
  \multicolumn{3}{l}{\underline{\smash{Ordinary Income}}} \\
  & Income \\
  & & Fee for Service (Fogel) & \VAR{fogel_income} \\
  & & Fee for Service (Vasile) & \VAR{vasile_income} \\
  \cline{4-4}
  & \multicolumn{2}{l}{Total Income} & \VAR{ots_income} \\
  & \\
  & \multicolumn{2}{l}{Cost Of Goods Sold} & \$0.00 \\
  & \\
  \cline{4-4}
  & \multicolumn{2}{l}{Total COGS} & \$0.00 \\
  & \\
  \multicolumn{3}{l}{\textbf{\underline{\smash{Gross Income}}}} & \textbf{\VAR{ots_income}} \\
  & \\
  & \\
  \multicolumn{3}{l}{\underline{\smash{Expenses}}} \\
  & \\
  \multicolumn{3}{l}{~~~~~\textit{Karl Fogel Expenses:}} \\
  \BLOCK{ for expense in fogel_expenses }
    \multicolumn{1}{l}{~~~~~~~~} & \multicolumn{2}{l}{\VAR{expense.name}} & \VAR{expense.amount} \\
  \BLOCK{ endfor }
   \cline{2-2}
   \cline{4-4}
   & \multicolumn{2}{l}{Karl Fogel Total Expenses:} & \VAR{fogel_expenses_total} \\
  & \\
  \multicolumn{3}{l}{~~~~~\textit{James Vasile Expenses:}} \\
  \BLOCK{ for expense in vasile_expenses }
    \multicolumn{1}{l}{~~~~~~~~} & \multicolumn{2}{l}{\VAR{expense.name}} & \VAR{expense.amount} \\
  \BLOCK{ endfor }
   \cline{2-2}
   \cline{4-4}
   & \multicolumn{2}{l}{James Vasile Total Expenses:} & \VAR{vasile_expenses_total} \\
  & \\
  \multicolumn{3}{l}{~~~~\textbf{\underline{\smash{Total Expenses}}}} & \VAR{ots_expenses} \\
  & \\
  %\cline{4-4}
  %\multicolumn{3}{l}{~~~~Net Ordinary Income} & \VAR{net_income}\\
  & \\
  \multicolumn{3}{l}{\textbf{\underline{\smash{Net Income}}}} \\
  & \multicolumn{2}{l}{James Vasile Net Ordinary Income} & \VAR{vasile_net_income} \\
  & \multicolumn{2}{l}{Karl Fogel Net Ordinary Income} &  \VAR{fogel_net_income} \\
  \cline{4-4}
  \multicolumn{3}{l}{~~~~\textbf{\underline{\smash{OTS Net Income}}}} & \VAR{net_income} \\
  & \\
  & \\
  \multicolumn{3}{l}{\textbf{James Vasile \VAR{year} Guaranteed Payments:}}  & \textbf{\VAR{vasile_guaranteed}} \\
  & \\
  \multicolumn{3}{l}{\textbf{Karl Fogel \VAR{year} Guaranteed Payments:}} & \textbf{\VAR{fogel_guaranteed}} \\

  % If we use multicolumn, make sure we also hit those columns
  % unspanned or LaTeX gets confused
  ~&~&~ \\
  \end{longtable}
\BLOCK{endblock}